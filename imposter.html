<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>the outlier</title>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600&family=Syne:wght@400;700;800&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  :root { --bg: #0d0d0f; --surface: #16161a; --border: #2a2a30; --text: #e8e8f0; --accent: #e8ff47; --wrong: #ff4444; }

  body { background: var(--bg); color: var(--text); font-family: 'IBM Plex Mono', monospace; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
  button { border-radius: 0px !important; cursor: pointer; font-family: 'Syne'; font-weight: 700; transition: 0.2s; }

  header { padding: 15px 25px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
  header h1 { font-family: 'Syne'; font-size: 1.1rem; color: var(--accent); }
  .back-link { color: var(--muted); text-decoration: none; font-size: 0.7rem; border: 1px solid var(--border); padding: 5px 10px; }

  .game-container { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
  
  #word-display { font-family: 'Syne'; font-size: 2rem; margin-bottom: 30px; text-transform: uppercase; letter-spacing: -0.05em; }

  .players-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; width: 100%; max-width: 900px; }
  
  .player-card { 
    background: var(--surface); border: 1px solid var(--border); padding: 20px; 
    text-align: center; position: relative; cursor: pointer;
  }
  .player-card:hover { border-color: var(--accent); }
  .player-card.selected { border-color: var(--accent); background: #1e1e0a; }
  .player-card.reveal-true { border-color: #44ff44; background: #0a1e0a; }
  .player-card.reveal-false { border-color: var(--wrong); background: #1e0a0a; }

  .p-name { display: block; font-family: 'Syne'; font-size: 0.8rem; color: var(--accent); margin-bottom: 10px; }
  .p-desc { font-size: 0.75rem; color: #ccc; min-height: 40px; line-height: 1.4; }
  .typing-status { font-size: 0.6rem; color: var(--muted); margin-top: 10px; font-style: italic; }

  .controls { margin-top: 40px; display: flex; gap: 15px; }
  .btn-main { background: var(--accent); color: #000; border: none; padding: 12px 30px; }
  .btn-main:disabled { opacity: 0.3; }

  #result-msg { margin-top: 20px; font-family: 'Syne'; font-weight: 800; font-size: 1.2rem; height: 1.5rem; }
</style>
</head>
<body>

<header>
  <h1>the outlier</h1>
  <a href="index.html" class="back-link">‚Üê BACK TO HUB</a>
</header>

<div class="game-container">
  <div id="word-display">Your Word: <span id="secret-word">???</span></div>
  
  <div class="players-grid" id="grid">
    </div>

  <div id="result-msg"></div>

  <div class="controls">
    <button id="start-btn" class="btn-main" onclick="startGame()">NEW ROUND</button>
    <button id="vote-btn" class="btn-main" style="background: white;" onclick="submitVote()" disabled>VOTE FOR IMPOSTER</button>
  </div>
</div>

<script>
const KEY = "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"; // YOUR KEY

const WORD_PAIRS = [
  { real: "Coffee", fake: "Gasoline" },
  { real: "Smartphone", fake: "Remote Control" },
  { real: "Tuna", fake: "Kitten" },
  { real: "Rain", fake: "Sweat" },
  { real: "Teacher", fake: "Dictator" },
  { real: "Gym", fake: "Prison" }
];

const NAMES = ["KAEL", "ZYLA", "BARD", "GLORP", "SOLEN"];
let bots = [];
let outlierIndex = -1;
let selectedIndex = -1;

function startGame() {
  document.getElementById("result-msg").innerText = "";
  document.getElementById("vote-btn").disabled = true;
  document.getElementById("start-btn").disabled = true;
  
  const pair = WORD_PAIRS[Math.floor(Math.random() * WORD_PAIRS.length)];
  outlierIndex = Math.floor(Math.random() * 5);
  document.getElementById("secret-word").innerText = pair.real;

  bots = NAMES.map((name, i) => ({
    name,
    word: (i === outlierIndex) ? pair.fake : pair.real,
    desc: "...",
    color: ["#ff3c3c","#a78bfa","#f5c842","#4affda","#5cffa8"][i]
  }));

  renderGrid();
  generateDescriptions();
}

function renderGrid() {
  const grid = document.getElementById("grid");
  grid.innerHTML = bots.map((b, i) => `
    <div class="player-card" id="card-${i}" onclick="selectPlayer(${i})">
      <span class="p-name" style="color:${b.color}">${b.name}</span>
      <div class="p-desc" id="desc-${i}">${b.desc}</div>
      <div class="typing-status" id="status-${i}">waiting...</div>
    </div>
  `).join('');
}

async function generateDescriptions() {
  for (let i = 0; i < bots.length; i++) {
    const status = document.getElementById(`status-${i}`);
    status.innerText = "thinking...";
    
    // Simulate thinking delay
    await new Promise(r => setTimeout(r, 1000 + Math.random() * 1500));

    try {
      const res = await fetch("https://api.groq.com/openai/v1/chat/completions", {
        method: "POST",
        headers: { "Content-Type": "application/json", "Authorization": `Bearer ${KEY}` },
        body: JSON.stringify({
          model: "llama-3.3-70b-versatile",
          max_tokens: 40,
          messages: [{
            role: "system", 
            content: `You are playing a game. Your secret word is ${bots[i].word}. Describe it in exactly ONE short, subtle sentence. DO NOT say the word. If you are the outlier, try to blend in with people describing the other word.`
          }, {role: "user", content: "Describe your secret word."}]
        })
      });
      const data = await res.json();
      bots[i].desc = data.choices[0].message.content.replace(/"/g, '');
      document.getElementById(`desc-${i}`).innerText = bots[i].desc;
      status.innerText = "ready";
    } catch (e) { console.error(e); }
  }
  document.getElementById("vote-btn").disabled = false;
  document.getElementById("start-btn").disabled = false;
}

function selectPlayer(i) {
  if (document.getElementById("vote-btn").disabled && active) return;
  selectedIndex = i;
  document.querySelectorAll('.player-card').forEach(c => c.classList.remove('selected'));
  document.getElementById(`card-${i}`).classList.add('selected');
}

function submitVote() {
  if (selectedIndex === -1) return;
  const result = document.getElementById("result-msg");
  
  document.querySelectorAll('.player-card').forEach((c, i) => {
    if (i === outlierIndex) c.classList.add('reveal-true');
    else if (i === selectedIndex) c.classList.add('reveal-false');
  });

  if (selectedIndex === outlierIndex) {
    result.innerText = "CORRECT. YOU FOUND THE OUTLIER.";
    result.style.color = "#44ff44";
  } else {
    result.innerText = `WRONG. IT WAS ${bots[outlierIndex].name}.`;
    result.style.color = "var(--wrong)";
  }
  document.getElementById("vote-btn").disabled = true;
}

setupBots(); // Initial names
</script>
</body>
</html>
