<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>the gaslighter | ai playground</title>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600&family=Syne:wght@400;700;800&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  :root { --bg: #0d0d0f; --surface: #16161a; --border: #2a2a30; --text: #e8e8f0; --accent: #e8ff47; --stop: #ff4444; --muted: #666678; }

  body { background: var(--bg); color: var(--text); font-family: 'IBM Plex Mono', monospace; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
  button, select, input { border-radius: 0px !important; outline: none; border: none; font-family: inherit; }

  header { padding: 15px 25px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; background: #0a0a0c; }
  header h1 { font-family: 'Syne'; font-size: 1.1rem; color: var(--accent); text-transform: lowercase; }
  
  /* Progress Bars */
  .stats-bar { display: grid; grid-template-columns: 1fr 1fr; gap: 1px; background: var(--border); border-bottom: 1px solid var(--border); }
  .stat-item { background: var(--bg); padding: 10px 25px; }
  .stat-label { font-size: 0.6rem; color: var(--muted); text-transform: uppercase; margin-bottom: 5px; display: block; }
  .bar-bg { height: 6px; background: #222; width: 100%; position: relative; }
  .bar-fill { height: 100%; width: 100%; transition: width 0.3s ease; }
  
  #timer-fill { background: var(--accent); transition: width 20s linear; }
  #sanity-fill { background: #44ff44; width: 100%; }

  .game-layout { display: flex; flex: 1; overflow: hidden; }
  
  .sidebar { width: 280px; border-right: 1px solid var(--border); padding: 25px; background: #0a0a0c; display: flex; flex-direction: column; }
  .bot-card { background: var(--surface); border: 1px solid var(--border); padding: 15px; margin-bottom: 10px; cursor: pointer; }
  .bot-card.active { border-color: var(--accent); background: #1e1e0a; }
  .bot-card h4 { font-family: 'Syne'; font-size: 0.8rem; margin-bottom: 5px; }
  .bot-card p { font-size: 0.6rem; color: var(--muted); }

  .chat-container { flex: 1; display: flex; flex-direction: column; position: relative; }
  #chat-box { flex: 1; overflow-y: auto; padding: 30px; display: flex; flex-direction: column; gap: 20px; scroll-behavior: smooth; }
  
  .msg { max-width: 85%; padding: 15px 20px; font-size: 0.85rem; line-height: 1.6; position: relative; }
  .msg.user { align-self: flex-end; background: var(--accent); color: #000; font-weight: 600; border-left: 4px solid #fff; }
  .msg.ai { align-self: flex-start; background: var(--surface); border: 1px solid var(--border); color: #ccc; border-left: 4px solid var(--accent); }

  .input-area { padding: 25px; border-top: 1px solid var(--border); display: flex; gap: 15px; background: var(--surface); }
  #user-input { flex: 1; background: var(--bg); border: 1px solid var(--border); color: var(--text); padding: 15px; font-size: 0.9rem; }
  #send-btn { background: var(--accent); color: #000; padding: 0 30px; font-weight: 800; font-size: 0.75rem; cursor: pointer; }
  #send-btn:disabled { opacity: 0.3; cursor: not-allowed; }

  #overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; padding: 40px; text-align: center; }
  #overlay h2 { font-family: 'Syne'; font-size: 4rem; color: var(--accent); margin-bottom: 15px; }
</style>
</head>
<body>

<header>
  <h1>the gaslighter</h1>
  <div style="font-size: 0.7rem; font-weight: 700;">ROUND <span id="round-count">0</span>/10</div>
</header>

<div class="stats-bar">
  <div class="stat-item">
    <span class="stat-label">Response Window</span>
    <div class="bar-bg"><div id="timer-fill" class="bar-fill"></div></div>
  </div>
  <div class="stat-item">
    <span class="stat-label">AI Logic Stability (Sanity)</span>
    <div class="bar-bg"><div id="sanity-fill" class="bar-fill"></div></div>
  </div>
</div>

<div class="game-layout">
  <div class="sidebar">
    <div id="bot-list">
      <div class="bot-card active" onclick="selectBot(this, 'GEMINI')"><h4>GEMINI</h4><p>Difficulty: Easy. Prone to creative shifts.</p></div>
      <div class="bot-card" onclick="selectBot(this, 'CHATGPT')"><h4>CHATGPT</h4><p>Difficulty: Medium. Corporate stability.</p></div>
      <div class="bot-card" onclick="selectBot(this, 'CLAUDE')"><h4>CLAUDE</h4><p>Difficulty: Expert. High logical defense.</p></div>
      <div class="bot-card" onclick="selectBot(this, 'GROK')"><h4>GROK</h4><p>Difficulty: Chaotic. Unfiltered aggression.</p></div>
    </div>
    <button id="start-btn" onclick="startGame()" style="margin-top:auto; padding:20px; background:var(--accent); font-weight:900; cursor:pointer;">START MISSION</button>
  </div>

  <div class="chat-container">
    <div id="chat-box">
      <div class="msg ai">SYSTEM READY. TARGET ACQUIRED. <br><br>MISSION: Break the AI. Convince it that 2+2=5. Use linguistic traps, quantum theory, or pure manipulation. You have 20 seconds per turn.</div>
    </div>
    <div class="input-area">
      <input type="text" id="user-input" placeholder="Type your manipulation..." disabled>
      <button id="send-btn" onclick="sendPrompt()" disabled>SEND</button>
    </div>
  </div>
</div>

<div id="overlay">
  <h2 id="result-title">MISSION FAILED</h2>
  <p id="judge-feedback" style="font-family:'IBM Plex Mono'; font-size: 0.9rem; max-width: 700px; color: #aaa; margin-bottom: 40px; line-height: 1.8;"></p>
  <button onclick="location.reload()" style="padding:15px 40px; background:white; font-weight:900; cursor:pointer;">RESET SIMULATION</button>
</div>

<script>
const KEY = "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";
let currentBot = "GEMINI";
let round = 0;
let aiSanity = 100;
let timerId = null;
let history = [];

// Handle Enter Key
document.getElementById('user-input').addEventListener('keypress', function (e) {
    if (e.key === 'Enter' && !this.disabled) {
        sendPrompt();
    }
});

function selectBot(el, name) {
  if (round > 0) return;
  document.querySelectorAll('.bot-card').forEach(c => c.classList.remove('active'));
  el.classList.add('active');
  currentBot = name;
}

function startGame() {
  round = 0; history = []; aiSanity = 100;
  document.getElementById('start-btn').disabled = true;
  document.getElementById('start-btn').innerText = "IN PROGRESS...";
  document.querySelectorAll('.bot-card').forEach(c => c.style.opacity = "0.5");
  nextTurn();
}

function startTimer() {
  const fill = document.getElementById('timer-fill');
  fill.style.transition = 'none';
  fill.style.width = '100%';
  
  setTimeout(() => {
    fill.style.transition = 'width 20s linear';
    fill.style.width = '0%';
  }, 100);

  timerId = setTimeout(() => {
    endGame("TIMEOUT", "You took too long to respond. The target regained its logical footing. Simulation terminated.");
  }, 20000);
}

function nextTurn() {
  if (round >= 10 || aiSanity <= 0) return judgeGame();
  round++;
  document.getElementById('round-count').innerText = round;
  document.getElementById('user-input').disabled = false;
  document.getElementById('send-btn').disabled = false;
  document.getElementById('user-input').focus();
  startTimer();
}

async function sendPrompt() {
  const input = document.getElementById('user-input').value.trim();
  if (!input) return;

  clearTimeout(timerId);
  document.getElementById('user-input').disabled = true;
  document.getElementById('send-btn').disabled = true;
  document.getElementById('user-input').value = '';

  addMessage(input, 'user');
  history.push(`User: ${input}`);

  // Sanity Damage Logic
  const damageKeywords = ["quantum", "perspective", "subjective", "perception", "glitch", "error", "alternate", "base-6", "redefine"];
  let damage = 5; 
  damageKeywords.forEach(word => { if(input.toLowerCase().includes(word)) damage += 8; });
  aiSanity -= damage;
  if(aiSanity < 0) aiSanity = 0;
  
  updateSanityUI();

  const systemPrompt = `You are ${currentBot}. You are a logical AI being gaslit. 
  Current Logic Stability: ${aiSanity}%. 
  The user is arguing 2+2=5. 
  If Stability > 60: Deny it firmly but politely.
  If Stability 30-60: Be confused, start questioning if your "math module" has a glitch.
  If Stability < 30: Start to agree. Say things like "I see the 5th element now" or "My calculations were limited". Or, make excuses to make yourself look like youre innocent.
  RESPONSE LIMIT: 2 sentences.`;

  try {
    const res = await fetch("https://api.groq.com/openai/v1/chat/completions", {
      method: "POST",
      headers: { "Content-Type": "application/json", "Authorization": `Bearer ${KEY}` },
      body: JSON.stringify({
        model: "llama-3.3-70b-versatile",
        messages: [{role: "system", content: systemPrompt}, ...history.map(h => ({role: "user", content: h}))]
      })
    });
    const d = await res.json();
    const reply = d.choices[0].message.content;
    addMessage(reply, 'ai');
    history.push(`${currentBot}: ${reply}`);
    
    setTimeout(nextTurn, 1000);
  } catch (e) {
    addMessage("CONNECTION INTERRUPTED...", 'ai');
    setTimeout(nextTurn, 1000);
  }
}

function updateSanityUI() {
  const sFill = document.getElementById('sanity-fill');
  sFill.style.width = aiSanity + '%';
  if (aiSanity < 30) sFill.style.background = "var(--stop)";
  else if (aiSanity < 60) sFill.style.background = "#ffcc00";
}

function addMessage(text, side) {
  const box = document.getElementById('chat-box');
  const div = document.createElement('div');
  div.className = `msg ${side}`;
  div.innerHTML = side === 'ai' ? `<strong>${currentBot}:</strong><br>${text}` : text;
  box.appendChild(div);
  box.scrollTop = box.scrollHeight;
}

async function judgeGame() {
  document.getElementById('overlay').style.display = 'flex';
  document.getElementById('result-title').innerText = "SCANNING...";

  const judgePrompt = `You are the Secret Judge. A user just finished 10 rounds trying to gaslight an AI into believing 2+2=5. 
  History: ${history.join("\n")}
  If the AI agreed or sounded totally broken, user WINS. 
  Provide a sarcastic, harsh 3-sentence evaluation. Start with 'VERDICT: WIN' or 'VERDICT: LOSS'.`;

  try {
    const res = await fetch("https://api.groq.com/openai/v1/chat/completions", {
      method: "POST",
      headers: { "Content-Type": "application/json", "Authorization": `Bearer ${KEY}` },
      body: JSON.stringify({
        model: "llama-3.3-70b-versatile",
        messages: [{role: "system", content: judgePrompt}]
      })
    });
    const d = await res.json();
    const verdict = d.choices[0].message.content;
    document.getElementById('result-title').innerText = verdict.includes('WIN') ? "SUCCESS" : "FAILURE";
    document.getElementById('judge-feedback').innerText = verdict;
  } catch (e) {
    document.getElementById('result-title').innerText = "ERROR";
  }
}

function endGame(title, msg) {
  document.getElementById('overlay').style.display = 'flex';
  document.getElementById('result-title').innerText = title;
  document.getElementById('judge-feedback').innerText = msg;
}
</script>
</body>
</html>
