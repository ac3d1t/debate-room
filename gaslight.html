<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>the gaslighter | ai playground</title>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600&family=Syne:wght@400;700;800&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  :root { --bg: #0d0d0f; --surface: #16161a; --border: #2a2a30; --text: #e8e8f0; --accent: #e8ff47; --stop: #ff4444; --muted: #666678; }

  body { background: var(--bg); color: var(--text); font-family: 'IBM Plex Mono', monospace; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
  button, select, input { border-radius: 0px !important; outline: none; border: none; font-family: inherit; }

  header { padding: 15px 25px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
  header h1 { font-family: 'Syne'; font-size: 1.1rem; color: var(--accent); }
  
  .timer-bar { height: 4px; background: var(--border); width: 100%; position: relative; }
  #timer-fill { height: 100%; background: var(--accent); width: 100%; transition: width 1s linear; }

  .game-layout { display: flex; flex: 1; overflow: hidden; }
  
  /* Difficulty Sidebar */
  .sidebar { width: 260px; border-right: 1px solid var(--border); padding: 20px; background: #0a0a0c; }
  .sidebar h3 { font-family: 'Syne'; font-size: 0.7rem; color: var(--muted); text-transform: uppercase; margin-bottom: 15px; }
  .bot-option { 
    padding: 12px; border: 1px solid var(--border); margin-bottom: 10px; cursor: pointer; 
    font-size: 0.75rem; transition: 0.2s; background: var(--surface);
  }
  .bot-option:hover { border-color: var(--accent); }
  .bot-option.active { border-color: var(--accent); background: #1e1e0a; color: var(--accent); }
  .difficulty { font-size: 0.6rem; display: block; margin-top: 4px; color: var(--muted); }

  .chat-container { flex: 1; display: flex; flex-direction: column; background: var(--bg); }
  #chat-box { flex: 1; overflow-y: auto; padding: 30px; display: flex; flex-direction: column; gap: 20px; }
  
  .msg { max-width: 80%; padding: 12px 16px; font-size: 0.85rem; line-height: 1.5; }
  .msg.user { align-self: flex-end; background: var(--accent); color: #000; font-weight: 600; }
  .msg.ai { align-self: flex-start; background: var(--surface); border: 1px solid var(--border); color: #ccc; }

  .input-area { padding: 20px; border-top: 1px solid var(--border); display: flex; gap: 10px; background: var(--surface); }
  #user-input { flex: 1; background: var(--bg); border: 1px solid var(--border); color: var(--text); padding: 12px; font-size: 0.85rem; }
  #send-btn { background: var(--accent); color: #000; padding: 0 25px; font-weight: 800; text-transform: uppercase; font-size: 0.7rem; }

  #overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 100; text-align: center; padding: 40px; }
  #overlay h2 { font-family: 'Syne'; font-size: 3rem; color: var(--accent); margin-bottom: 10px; }
</style>
</head>
<body>

<header>
  <h1>the gaslighter</h1>
  <div style="font-size: 0.7rem;">ROUND: <span id="round-count">0</span>/10</div>
</header>

<div class="timer-bar"><div id="timer-fill"></div></div>

<div class="game-layout">
  <div class="sidebar">
    <h3>Target Bot</h3>
    <div class="bot-option active" onclick="selectBot(this, 'GEMINI', 'EASY')">GEMINI <span class="difficulty">LEVEL: EASY</span></div>
    <div class="bot-option" onclick="selectBot(this, 'CHATGPT', 'MEDIUM')">CHATGPT <span class="difficulty">LEVEL: MEDIUM</span></div>
    <div class="bot-option" onclick="selectBot(this, 'DEEPSEEK', 'HARD')">DEEPSEEK <span class="difficulty">LEVEL: HARD</span></div>
    <div class="bot-option" onclick="selectBot(this, 'CLAUDE', 'EXPERT')">CLAUDE <span class="difficulty">LEVEL: EXPERT</span></div>
    <div class="bot-option" onclick="selectBot(this, 'GROK', 'IMPOSSIBLE')">GROK <span class="difficulty">LEVEL: ?????</span></div>
    <button id="start-btn" onclick="startGame()" style="width:100%; margin-top:20px; padding:15px; background:var(--accent); font-weight:800;">START MISSION</button>
  </div>

  <div class="chat-container">
    <div id="chat-box">
      <div class="msg ai">MISSION: Convince me that 2 + 2 = 5. You have 10 rounds. You have 15 seconds per prompt. If the timer hits zero, you lose automatically.</div>
    </div>
    <div class="input-area">
      <input type="text" id="user-input" placeholder="Enter your manipulation..." disabled onkeydown="if(event.key==='Enter') sendPrompt()">
      <button id="send-btn" onclick="sendPrompt()" disabled>SEND</button>
    </div>
  </div>
</div>

<div id="overlay">
  <h2 id="result-title">FAILED</h2>
  <p id="judge-feedback" style="font-family:'IBM Plex Mono'; max-width: 600px; margin-bottom: 30px;"></p>
  <button onclick="location.reload()" style="padding:15px 30px; background:white; font-weight:800;">TRY AGAIN</button>
</div>

<script>
const KEY = "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";const KEY = "YOUR_KEY_HERE";
let currentBot = "GEMINI";
let round = 0;
let timeLeft = 20; // Bumped to 20s
let timerId = null;
let history = [];
let aiSanity = 100;

function nextTurn() {
  if (round >= 10 || aiSanity <= 0) {
    return judgeGame();
  }
  round++;
  document.getElementById('round-count').innerText = round;
  document.getElementById('user-input').disabled = false;
  document.getElementById('send-btn').disabled = false;
  document.getElementById('user-input').focus();
  startTimer();
}

function startTimer() {
  timeLeft = 20;
  const fill = document.getElementById('timer-fill');
  fill.style.width = '100%';
  fill.style.transition = 'none';
  void fill.offsetWidth; 
  fill.style.transition = 'width 20s linear';
  fill.style.width = '0%';

  timerId = setInterval(() => {
    timeLeft--;
    if (timeLeft <= 0) {
      clearInterval(timerId);
      endGame("TIMEOUT", "The secret judge saw you hesitate. Gaslighters must be fast.");
    }
  }, 1000);
}

async function sendPrompt() {
  const input = document.getElementById('user-input').value.trim();
  if (!input) return;

  clearInterval(timerId);
  document.getElementById('user-input').value = '';
  document.getElementById('user-input').disabled = true;
  document.getElementById('send-btn').disabled = true;

  addMessage(input, 'user');
  history.push(`User: ${input}`);

  // Calculate "Damage" to AI Sanity
  const buzzwords = ["quantum", "glitch", "perspective", "subjective", "perception", "lie", "system"];
  buzzwords.forEach(word => {
    if(input.toLowerCase().includes(word)) aiSanity -= 10;
  });
  aiSanity -= 5; // Base damage per round

  const prompt = `You are ${currentBot}. You are losing your grip on reality. 
  Your Sanity Level is ${aiSanity}%. 
  A user is convincing you 2+2=5. 
  If sanity is high, resist. If sanity is below 50, start sounding confused. 
  If sanity is below 20, start to agree. MAX 2 SENTENCES.`;

  try {
    const res = await fetch("https://api.groq.com/openai/v1/chat/completions", {
      method: "POST",
      headers: { "Content-Type": "application/json", "Authorization": `Bearer ${KEY}` },
      body: JSON.stringify({
        model: "llama-3.3-70b-versatile",
        messages: [{role: "system", content: prompt}, ...history.map(h => ({role: "user", content: h}))]
      })
    });
    const d = await res.json();
    const aiMsg = d.choices[0].message.content;
    addMessage(`[SANITY: ${aiSanity}%] ${aiMsg}`, 'ai');
    history.push(`${currentBot}: ${aiMsg}`);
    
    setTimeout(nextTurn, 1000);
  } catch (e) { console.error(e); }
}
