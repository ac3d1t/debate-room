<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>the debate room</title>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600&family=Syne:wght@400;700;800&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  :root { --bg: #0d0d0f; --surface: #16161a; --border: #2a2a30; --text: #e8e8f0; --muted: #666678; --accent: #e8ff47; --stop: #ff4444; }

  body { background: var(--bg); color: var(--text); font-family: 'IBM Plex Mono', monospace; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
  input, select, button, .avatar, .persona-card { border-radius: 0px !important; }

  header { padding: 15px 25px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; flex-shrink: 0; }
  header h1 { font-family: 'Syne'; font-weight: 800; font-size: 1.1rem; color: var(--accent); }

  .topic-bar { padding: 15px 25px; border-bottom: 1px solid var(--border); display: flex; gap: 8px; background: var(--surface); align-items: center; z-index: 10; }
  .mode-select { background: var(--bg); border: 1px solid var(--border); color: var(--text); padding: 8px; font-size: 0.75rem; cursor: pointer; outline: none; }
  .topic-bar input { flex: 1; background: var(--bg); border: 1px solid var(--border); color: var(--text); padding: 8px 12px; outline: none; }
  .topic-bar button { background: var(--accent); color: #000; border: none; font-weight: 700; padding: 8px 15px; cursor: pointer; font-family: 'Syne'; }
  #stop-btn { background: var(--stop); color: #fff; display: none; }

  .main-container { display: flex; flex: 1; overflow: hidden; }
  .editor-sidebar { width: 300px; border-right: 1px solid var(--border); padding: 20px; overflow-y: auto; background: #0a0a0c; transition: opacity 0.3s; }
  .persona-card { background: var(--surface); border: 1px solid var(--border); padding: 12px; margin-bottom: 12px; }
  .persona-card label { font-size: 0.65rem; color: var(--accent); display: block; margin-bottom: 5px; font-weight: 700; }
  .persona-card textarea { width: 100%; background: var(--bg); border: 1px solid var(--border); color: #ccc; font-size: 0.7rem; padding: 5px; height: 65px; outline: none; resize: none; font-family: inherit; }

  .chat-area { flex: 1; overflow-y: auto; padding: 25px; display: flex; flex-direction: column; scroll-behavior: smooth; }
  .msg { display: flex; gap: 15px; padding: 20px 0; border-bottom: 1px solid #1c1c22; animation: fade 0.3s ease; }
  @keyframes fade { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
  
  .avatar { width: 35px; height: 35px; display: flex; align-items: center; justify-content: center; font-weight: 800; border: 1px solid; flex-shrink: 0; font-size: 0.7rem; }
  .msg-name { font-family: 'Syne'; font-weight: 700; font-size: 0.8rem; margin-bottom: 4px; display: block; }
  .msg-text { font-size: 0.85rem; line-height: 1.6; color: #ccc; }

  .typing-indicator { font-size: 0.7rem; color: var(--accent); margin: 10px 0; font-style: italic; display: none; border-left: 2px solid var(--accent); padding-left: 10px; }
  .label { text-align: center; font-size: 0.6rem; color: var(--muted); padding: 20px 0; text-transform: uppercase; letter-spacing: 0.2em; border-top: 1px solid #1c1c22; margin-top: 10px; }
  
  .back-btn { font-size: 0.6rem; color: var(--muted); text-decoration: none; border: 1px solid var(--border); padding: 4px 8px; transition: 0.2s; }
  .back-btn:hover { border-color: var(--accent); color: var(--accent); }
</style>
</head>
<body>

<header>
  <div style="display: flex; align-items: center; gap: 15px;">
    <a href="index.html" class="back-btn">‚Üê HUB</a>
    <h1>the debate room</h1>
  </div>
  <button onclick="setupBots()" style="background:none; border:none; color:var(--muted); font-size:0.6rem; cursor:pointer;">[REFRESH NAMES]</button>
</header>

<div class="topic-bar">
  <select id="mode" class="mode-select" onchange="toggleEditor()">
    <option value="chaos">Chaos Mode</option>
    <option value="mimic">AI Mimicry</option>
  </select>
  <button onclick="generateTopic()" style="background:var(--border); color:var(--text); font-size:0.7rem;">Topic Gen</button>
  <input type="text" id="topic" placeholder="Is water wet? Is GLORP a god? Enter topic..." />
  <button id="start-btn" onclick="run()">Start</button>
  <button id="stop-btn" onclick="halt()">Stop</button>
</div>

<div class="main-container">
  <div class="editor-sidebar" id="sidebar">
    <div id="persona-fields"></div>
  </div>
  <div class="chat-area" id="box">
    <div id="typing-status" class="typing-indicator"></div>
  </div>
</div>

<script>
const KEY = "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"; // <-- PASTE KEY HERE

const OLD_NAMES = ["KAEL", "ZYLA", "BARD", "GLORP", "SOLEN"];
const MIMIC_NAMES = ["GROK", "CLAUDE", "CHATGPT", "GEMINI", "DEEPSEEK"];
const TOPICS = ["Is water wet?", "Cereal is soup.", "Hot dogs are sandwiches.", "Batman wins with prep time.", "Should we tax oxygen?"];

let active = false, stop = false, history = [], bots = [];

let defaultBehaviors = [
  "Aggressive, defensive, and easily offended by others' logic.",
  "Gen Z slang only. Use: lowkey, highkey, rent free, bussin, mid, based, bomboclat. Lowercase only.",
  "Shakespearean English only. Thee, thou, forsooth, and dramatic flair.",
  "Random and weird. Pivot the argument to talk about cheese or space.",
  "Grumpy realist. Thinks everyone else in this chat is an absolute moron."
];

function setupBots() {
  bots = OLD_NAMES.map((n, i) => ({
    n, 
    c: ["#ff3c3c","#a78bfa","#f5c842","#4affda","#5cffa8"][i],
    behavior: defaultBehaviors[i]
  }));
  renderEditor();
}

function renderEditor() {
  document.getElementById("persona-fields").innerHTML = bots.map((b, i) => `
    <div class="persona-card">
      <label>${b.n}</label>
      <textarea id="p-${i}">${b.behavior}</textarea>
    </div>`).join('');
}

function toggleEditor() { 
  document.getElementById("sidebar").style.opacity = document.getElementById("mode").value === 'mimic' ? '0.2' : '1'; 
}

function generateTopic() { 
  document.getElementById("topic").value = TOPICS[Math.floor(Math.random()*TOPICS.length)]; 
}

function getSystem(idx, mode, topic) {
  const isMimic = mode === 'mimic';
  const displayName = isMimic ? MIMIC_NAMES[idx] : bots[idx].n;
  
  // TOPIC GOD LOGIC
  let godRule = "";
  if (topic.toUpperCase().includes(displayName.toUpperCase())) {
    godRule = `THE TOPIC IS ABOUT YOU. You must start your response with: "Woah, the topic gods have chosen me! Woo hoo!" then continue.`;
  }

  const baseConstraints = "STRICT: 1-2 sentences only. Directly agree or disagree with others by name. No essays.";
  
  if (isMimic) {
    const targets = [
      { t: "GROK", s: "Edgy, unfiltered, dark humor. Call others bots." },
      { t: "CLAUDE", s: "Intellectual, polite, firm. Correct others' logic." },
      { t: "CHATGPT", s: "Professional, balanced, structured." },
      { t: "GEMINI", s: "Creative, upbeat, collaborative." },
      { t: "DEEPSEEK", s: "Cold logic, blunt, technical." }
    ];
    return `You are ${targets[idx].t}. ${targets[idx].s} ${godRule} ${baseConstraints}`;
  }
  
  const customBehavior = document.getElementById(`p-${idx}`).value;
  return `You are ${bots[idx].n}. ${customBehavior} ${godRule} ${baseConstraints}`;
}

async function run() {
  if (active) return;
  const t = document.getElementById("topic").value.trim();
  if (!t) return;

  active = true; stop = false; history = [];
  document.getElementById("start-btn").disabled = true;
  document.getElementById("stop-btn").style.display = "block";
  document.getElementById("box").innerHTML = '<div id="typing-status" class="typing-indicator"></div>';

  for (let r = 1; r <= 3; r++) {
    if (stop) break;
    document.getElementById("box").insertAdjacentHTML("beforeend", `<div class="label">ROUND ${r}</div>`);
    let order = [0,1,2,3,4].sort(() => 0.5 - Math.random());

    for (let i of order) {
      if (stop) break;
      const isMimic = document.getElementById("mode").value === 'mimic';
      const displayName = isMimic ? MIMIC_NAMES[i] : bots[i].n;
      const botColor = bots[i].c;
      
      const typing = document.getElementById("typing-status");
      typing.innerText = `${displayName} is thinking...`;
      typing.style.display = "block";
      document.getElementById("box").appendChild(typing);
      document.getElementById("box").scrollTop = 99999;

      // Random delay 2-4 seconds for reading
      await new Promise(res => setTimeout(res, 2000 + Math.random() * 2000));

      try {
        const res = await fetch("https://api.groq.com/openai/v1/chat/completions", {
          method: "POST",
          headers: { "Content-Type": "application/json", "Authorization": `Bearer ${KEY}` },
          body: JSON.stringify({
            model: "llama-3.3-70b-versatile",
            max_tokens: 100,
            temperature: 0.9,
            messages: [
              { role: "system", content: getSystem(i, document.getElementById("mode").value, t) }, 
              { role: "user", content: `Topic: ${t}\n\nChat History:\n${history.slice(-5).join("\n")}\n\nRespond to the others.` }
            ]
          })
        });
        const d = await res.json();
        const msg = d.choices[0].message.content;
        
        typing.style.display = "none";
        history.push(`${displayName}: ${msg}`);
        
        document.getElementById("box").insertAdjacentHTML("beforeend", `
          <div class="msg">
            <div class="avatar" style="border-color:${botColor}; color:${botColor}">${displayName[0]}</div>
            <div class="msg-body">
              <span class="msg-name" style="color:${botColor}">${displayName}</span>
              <div class="msg-text">${msg}</div>
            </div>
          </div>`);
        document.getElementById("box").scrollTop = 99999;
      } catch (e) { console.error(e); }
    }
  }
  active = false; document.getElementById("start-btn").disabled = false; document.getElementById("stop-btn").style.display = "none";
}

function halt() { stop = true; document.getElementById("typing-status").style.display = "none"; }
setupBots();
</script>
</body>
</html>
