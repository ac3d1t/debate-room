<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>the debate room</title>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600&family=Syne:wght@400;700;800&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  :root { 
    --bg: #0d0d0f; 
    --surface: #16161a; 
    --border: #2a2a30; 
    --text: #e8e8f0; 
    --muted: #666678; 
    --accent: #e8ff47; 
    --stop: #ff4444; 
  }

  body { 
    background: var(--bg); 
    color: var(--text); 
    font-family: 'IBM Plex Mono', monospace; 
    height: 100vh; 
    display: flex; 
    flex-direction: column; 
    overflow: hidden; 
  }

  header { 
    padding: 18px 28px; 
    border-bottom: 1px solid var(--border); 
    display: flex; 
    align-items: center; 
    justify-content: space-between;
    flex-shrink: 0; 
  }
  header h1 { font-family: 'Syne', sans-serif; font-weight: 800; font-size: 1.1rem; color: var(--accent); letter-spacing: -0.02em; }
  #status-label { font-size: 0.7rem; color: var(--muted); text-transform: uppercase; letter-spacing: 0.1em; }

  .topic-bar { 
    padding: 16px 28px; 
    border-bottom: 1px solid var(--border); 
    display: flex; 
    gap: 10px; 
    background: var(--surface); 
    align-items: center; 
  }
  
  /* SQUARE THE UNIVERSE (NO ROUNDED CORNERS) */
  .topic-bar input, .mode-select, .topic-bar button, .avatar { border-radius: 0px !important; }

  .mode-select { 
    background: var(--bg); 
    border: 1px solid var(--border); 
    color: var(--text); 
    font-family: 'IBM Plex Mono'; 
    font-size: 0.75rem; 
    padding: 10px; 
    cursor: pointer; 
    outline: none;
  }
  .mode-select:focus { border-color: var(--accent); }

  .topic-bar input { 
    flex: 1; 
    background: var(--bg); 
    border: 1px solid var(--border); 
    color: var(--text); 
    padding: 10px 14px; 
    outline: none; 
    font-family: 'IBM Plex Mono';
  }
  .topic-bar input:focus { border-color: var(--accent); }

  .topic-bar button { 
    background: var(--accent); 
    color: #000; 
    border: none; 
    font-family: 'Syne';
    font-weight: 700; 
    padding: 10px 22px; 
    cursor: pointer; 
    transition: 0.2s;
  }
  .topic-bar button:hover { opacity: 0.8; }
  .topic-bar button:disabled { opacity: 0.3; cursor: not-allowed; }

  #stop-btn { background: var(--stop); color: #fff; display: none; }

  .chat-area { 
    flex: 1; 
    overflow-y: auto; 
    padding: 24px 28px; 
    display: flex; 
    flex-direction: column; 
    scroll-behavior: smooth;
  }
  .chat-area::-webkit-scrollbar { width: 4px; }
  .chat-area::-webkit-scrollbar-thumb { background: var(--border); }

  .msg { 
    display: flex; 
    gap: 14px; 
    padding: 20px 0; 
    border-bottom: 1px solid #1c1c22; 
    animation: fadeUp 0.4s ease; 
  }
  @keyframes fadeUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

  .avatar { 
    width: 40px; 
    height: 40px; 
    display: flex; 
    align-items: center; 
    justify-content: center; 
    font-family: 'Syne'; 
    font-weight: 800; 
    flex-shrink: 0; 
    border: 1px solid; 
    font-size: 0.8rem;
    background: rgba(255,255,255,0.03);
  }

  .msg-body { flex: 1; min-width: 0; }
  .msg-header { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; }
  .msg-name { font-family: 'Syne'; font-weight: 700; font-size: 0.85rem; }
  .msg-text { font-size: 0.85rem; line-height: 1.7; color: #d0d0da; white-space: pre-wrap; }

  .label { 
    text-align: center; 
    font-size: 0.65rem; 
    color: var(--muted); 
    padding: 30px 0; 
    text-transform: uppercase; 
    letter-spacing: 0.3em; 
    border-top: 1px dashed var(--border);
    margin-top: 20px;
  }

  .error-box { 
    background: #2a1414; 
    color: #ff8080; 
    padding: 15px; 
    font-size: 0.75rem; 
    margin: 10px 0; 
    border: 1px solid #ff4444; 
    font-family: 'IBM Plex Mono';
  }

  .typing { font-size: 0.7rem; color: var(--muted); font-style: italic; margin-top: 10px; }
</style>
</head>
<body>

<header>
  <h1>the debate room</h1>
  <span id="status-label">Awaiting input...</span>
</header>

<div class="topic-bar">
  <select id="mode" class="mode-select">
    <option value="chaos">Chaos Personas</option>
    <option value="mimic">AI Mimicry</option>
  </select>
  <input type="text" id="topic" placeholder="What should they fight about?" />
  <button id="start-btn" onclick="run()">start debate</button>
  <button id="stop-btn" onclick="halt()">force stop</button>
</div>

<div class="chat-area" id="box"></div>

<script>
const KEY = "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"; // <--- CHANGE THIS

const NAME_POOL = ["XENON", "NEO", "VORTEX", "BYT3", "CYRUS", "AURA", "RAVEN", "ORBIT", "FLUX", "ZODIAC", "NOVA", "QUBIT", "ZENITH", "AETHER", "VECTOR", "ONYX", "PRISM", "AXIOM", "VOID", "DATA", "LOGIC", "COBALT", "TITAN", "SOLAR", "LUNAR", "CYBER", "OMEGA", "ALPHA", "CHRONOS", "KINETIC", "NEBULA", "PHANTOM", "SIREN", "DRACO", "LYRA", "ORION", "VEGA", "RIGEL", "SIRIUS", "ALTAIR", "SPICA", "ANTARES", "REGULUS", "MIRA", "BELLATRIX", "ALGOL", "HAMAL", "ACHERNAR", "ALNAIR", "HYDRA", "VELA", "PUPPIS", "PYXIS", "ANTLIA", "CRATER", "CORVUS", "PULSE", "KRYPTON", "ECHO", "SHADOW", "TITANIUM", "RADAR", "SONIC", "PLASMA", "FUSION", "ELECTRON", "NEUTRON", "PROTON", "ISOTOPE", "COSMOS", "QUARK", "HADRON", "LEPTON", "PHOTON", "BOSON"];

let active = false, stop = false, history = [], bots = [];

function setupBots() {
  const shuffled = [...NAME_POOL].sort(() => 0.5 - Math.random());
  bots = shuffled.slice(0, 5).map(n => ({
    name: n,
    color: ["#ff3c3c", "#a78bfa", "#f5c842", "#4affda", "#5cffa8", "#ff7eb9", "#e8ff47"][Math.floor(Math.random()*7)],
    initial: n.charAt(0)
  }));
}

function getSystemPrompt(idx, mode) {
  const bot = bots[idx];
  if (mode === 'mimic') {
    const mimickedAIs = [
      { name: "GROK", style: "You are GROK. Be edgy, unfiltered, anti-woke, and use sharp, rebellious humor. Be concise. 2-4 scentences." },
      { name: "CLAUDE", style: "You are CLAUDE by Anthropic. Be extremely intellectual, nuanced, polite, and very helpful. Use proper formatting. 2-4 scentences." },
      { name: "CHATGPT", style: "You are CHATGPT. Be balanced, professional, slightly verbose, and use a standard AI assistant tone. 2-4 scentences." },
      { name: "GEMINI", style: "You are GEMINI. Be creative, collaborative, upbeat, and focus on integrated information. Use a friendly tone. 2-4 scentences." },
      { name: "DEEPSEEK", style: "You are DEEPSEEK. Be highly efficient, technical, and use extremely logical arguments with no fluff. 2-4 scentences." }
    ];
    return `Identity: ${bot.name}. ${mimickedAIs[idx].style} DO NOT mention you are an AI. Engage in the debate topic intensely.`;
  } else {
    const chaosStyles = [
      "Extremely aggressive, defensive, and easily offended by others' logic. 2-4 scentences.",
      "Uses 100% Gen Z slang. Lowercase only. Words: mid, based, fr, no cap, bussin, lowkey. 2-4 scentences.",
      "Shakespearean English only. Use 'thee', 'thou', 'hath', and dramatic prose. 2-4 scentences.",
      "Completely off-topic. Every response must pivot to a random, weird unrelated subject. 2-4 scentences.",
      "An exhausted, grumpy realist who thinks the other 4 debaters are idiots. 2-4 scentences."
    ];
    return `Identity: ${bot.name}. Style: ${chaosStyles[idx]}. Keep responses to 2-3 sentences.`;
  }
}

function addLabel(txt) {
  const d = document.createElement("div"); d.className = "label"; d.innerText = txt;
  document.getElementById("box").appendChild(d);
  document.getElementById("box").scrollTop = 99999;
}

async function run() {
  if (active) return;
  const topicText = document.getElementById("topic").value.trim();
  if (!topicText) return;

  active = true; stop = false; history = [];
  setupBots();
  
  document.getElementById("start-btn").disabled = true;
  document.getElementById("stop-btn").style.display = "block";
  document.getElementById("status-label").innerText = "DEBATE IN PROGRESS";
  document.getElementById("box").innerHTML = "";

  addLabel(`TOPIC: ${topicText.toUpperCase()}`);

  for (let round = 1; round <= 3; round++) {
    if (stop) break;
    addLabel(`ROUND ${round}`);
    
    // POINT-TO-POINT: Shuffle turn order every single round
    let turnOrder = [0, 1, 2, 3, 4].sort(() => 0.5 - Math.random());

    for (let i of turnOrder) {
      if (stop) break;
      const bot = bots[i];
      const mode = document.getElementById("mode").value;
      
      try {
        const response = await fetch("https://api.groq.com/openai/v1/chat/completions", {
          method: "POST",
          headers: { 
            "Content-Type": "application/json", 
            "Authorization": `Bearer ${KEY}` 
          },
          body: JSON.stringify({
            model: "llama-3.3-70b-versatile",
            messages: [
              { role: "system", content: getSystemPrompt(i, mode) },
              { role: "user", content: `Debate Topic: ${topicText}\n\nRecent Argument History:\n${history.slice(-6).join("\n")}\n\nYour turn to speak:` }
            ],
            temperature: 0.8
          })
        });

        const data = await response.json();
        
        // Robust Error Handling for "choices[0]"
        if (!data.choices || data.choices.length === 0) {
          throw new Error(data.error ? data.error.message : "API returned an empty response.");
        }

        const content = data.choices[0].message.content;
        history.push(`${bot.name}: ${content}`);

        const msgHTML = `
          <div class="msg">
            <div class="avatar" style="border-color:${bot.color}; color:${bot.color}">${bot.initial}</div>
            <div class="msg-body">
              <span class="msg-name" style="color:${bot.color}">${bot.name}</span>
              <div class="msg-text">${content}</div>
            </div>
          </div>
        `;
        document.getElementById("box").insertAdjacentHTML("beforeend", msgHTML);
        document.getElementById("box").scrollTop = document.getElementById("box").scrollHeight;

      } catch (err) {
        document.getElementById("box").insertAdjacentHTML("beforeend", `
          <div class="error-box">
            <strong>CRITICAL ERROR:</strong><br>${err.message}<br>
            <small>Check your API key or usage limits.</small>
          </div>
        `);
      }
      // Natural pause between turns
      await new Promise(r => setTimeout(r, 1200));
    }
  }

  active = false;
  document.getElementById("start-btn").disabled = false;
  document.getElementById("stop-btn").style.display = "none";
  document.getElementById("status-label").innerText = stop ? "DEBATE ABORTED" : "DEBATE FINISHED";
}

function halt() { 
  stop = true; 
  addLabel("!! FORCE STOPPED BY OPERATOR !!"); 
}
</script>
</body>
</html>
